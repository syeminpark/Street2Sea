<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Cesium Tileset – fast view</title>
  <script src="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Cesium.js"></script>
  <link href="https://cesium.com/downloads/cesiumjs/releases/1.111/Build/Cesium/Widgets/widgets.css" rel="stylesheet"/>
  <style>html,body,#cesiumContainer{width:100%;height:100%;margin:0;overflow:hidden}</style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>
    (async () => {
      Cesium.Ion.defaultAccessToken = 'CESIUM_ION_TOKEN';

      const viewer = new Cesium.Viewer('cesiumContainer', {
        terrainProvider : await Cesium.CesiumTerrainProvider.fromIonAssetId(2767062),
        baseLayerPicker : false,
        timeline        : false,
        animation       : false,
        requestRenderMode: true
      });

      viewer.imageryLayers.addImageryProvider(
        new Cesium.UrlTemplateImageryProvider({
          url: '/osm/{z}/{x}/{y}.png',
          maximumLevel: 19,
          credit: '© OpenStreetMap contributors'
        })
      );
      viewer.scene.requestRenderMode = true

    const lon =139.6142023961819
      const lat = 35.65256823531473
      const heightAboveGround = 2.05;


      const position = Cesium.Cartographic.fromDegrees(lon, lat);
      const terrainProvider = viewer.terrainProvider;
      const [updatedPosition] = await Cesium.sampleTerrainMostDetailed(terrainProvider, [position]);

      const groundHeight = updatedPosition.height + heightAboveGround;

      await viewer.camera.flyTo({
        destination: Cesium.Cartesian3.fromDegrees(lon, lat, groundHeight),
        orientation: {
          heading: Cesium.Math.toRadians(336),
          pitch: Cesium.Math.toRadians(0),
          roll: 0
        }
      });
      viewer.camera.frustum.fov = Cesium.Math.toRadians(120);

      let tilesetLoaded = false;

      viewer.camera.moveEnd.addEventListener(async () => {
        if (tilesetLoaded) return;
        tilesetLoaded = true;

        const tileset = await Cesium.Cesium3DTileset.fromIonAssetId(2602291);

        viewer.scene.primitives.add(tileset);
        await tileset.readyPromise;

        console.log("Tileset loaded after camera finished moving");
      });

    })();
  </script>
</body>
</html>
